{% extends "base.html" %} {% block title %}Generate statistics{% endblock %}
{% block content%}
<form method="POST">
  <h1 align="left">Generate statistics</h1>
  <br />
  <div class="form-group">
    <label for="project_name">Project name:</label>
      {% for project_item in project_list %}
        {% if (project_id == project_item[0]): %}
          <input id="project_name" class="form-control" readonly value="{{ project_item[1] }}" />
          <input style="display: none" id="project_id" name="project_id" class="form-control" readonly value="{{ project_item[0] }}" />
        {% endif %}
      {% endfor %}
  </div>
  <div class="form-group">
    <label for="class_list">Select classes:</label>	
    <select multiple="multiple" id="class_list" name="class_list" style="width: 100%" class="form-control">
      {% for class in class_list %}
        {% if (class in selected_classes): %}
          <option value="{{ class }}" selected >{{ class }}</option>
        {% else %}
          <option value="{{ class }}" >{{ class }}</option>
        {% endif %}
      {% endfor %}
    </select>
  </div>
  <div class="form-group">
    <div class="row">
      <div class="col-md-11">
        <label for="chart_type">Chart:</label>
        <select id="chart_type" name="chart_type" class="form-control">
          <option value="null">Select a chart</option>
          {% for chart in chart_list %}
            {% if (chart == chart_type): %}
              <option value="{{ chart }}" selected>{{ chart }}</option>
            {% else %}
              <option value="{{ chart }}">{{ chart }}</option>
            {% endif %}
          {% endfor %}
        </select>
      </div>
      <div class="col-md-1" align="center">
          <label for="chart_type">&nbsp;</label>
          <button type="submit" class="btn btn-primary">Confirm</button>
      </div>
    </div>
  </div>
{% if (img_uri != '0'): %}
  <div class="form-group">
    <div class="row">
      <div class="col-md-12">
        <label for="analysis">Analysis:</label>
        <textarea id="analysis" class="form-control" rows="6"></textarea>
      </div>
    </div>
  </div>
  <div class="form-group">
    <div class="row">
      <div class="col-md-12">
        <button type="button" id="btn-analysis" class="btn btn-primary float-right">Submit analysis</button>
      </div>
    </div>
  </div>
  <div align="center">
      <img src='data:image/png;base64,{{ img_uri }}' width="85%" />
  </div>
{% endif %}

  <br />
    
</form>

<script>
  $('#class_list').multiSelect();
  $('.ms-container').css('width', '100%');

  $('#btn-analysis').on('click', function() {
    $.ajax({
      url: '/analysis',
      type: 'POST',
      data: {
        project_id: $('#project_id').val(),
        chart_type: $('#chart_type').val(),
        selected_classes: $('#class_list').val().join(';'),
        analysis: $('#analysis').val()
      },
      success: function (data) {
        alert(data.message);
        $('#analysis').val('');
      }
    });
  });
</script>
{% endblock %}
