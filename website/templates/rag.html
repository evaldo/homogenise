{% extends "base.html" %}
{% block title %}RAG{% endblock %}

{% block content %}
<h1 align="left">RAG - Graph QA</h1>

<!-- =============================
    1Ô∏è‚É£ Graph Upload Form
============================= -->
<form method="POST" enctype="multipart/form-data" onsubmit="showUploadSpinner()">
    <div class="form-group">
       <label for="file">Choose a TTL file:</label>
       <input type="file" name="file" id="file" accept=".ttl" class="form-control" onchange="showLoadButton()">
    </div>
    <br />
    <div id="loadButtonContainer" style="display: none;" align="center">
       <button type="submit" id="uploadButton" class="btn btn-primary">
          Import Graph and Create Embeddings
       </button>
       <div id="uploadSpinner" class="spinner-border text-primary mt-3" style="display:none;" role="status">
          <span class="visually-hidden">Loading...</span>
       </div>
       <p id="uploadMsg" style="display:none; margin-top:10px;">
          Importing graph and creating embeddings... This may take a few minutes ‚è≥
       </p>
    </div>
</form>

<hr />

<!-- =============================
    2Ô∏è‚É£ Question Form
============================= -->
<form method="POST" onsubmit="showQuestionSpinner()">
    <div class="form-group">
       <label for="pergunta">Ask a question about the graph:</label>
       <input type="text" name="pergunta" id="pergunta" class="form-control" placeholder="Type your question here..." required>
    </div>
    <br />
    <div align="center">
       <button type="submit" id="questionButton" class="btn btn-success">Send Question</button>
       <div id="questionSpinner" class="spinner-border text-success mt-3" style="display:none;" role="status">
          <span class="visually-hidden">Processing...</span>
       </div>
       <p id="questionMsg" style="display:none; margin-top:10px;">
          Querying the graph and generating answer... please wait ü§ñ
       </p>
    </div>
</form>

<!-- =============================
    3Ô∏è‚É£ Show RAG Answer
============================= -->
{% if resposta_rag %}
<div class="card mt-4">
    <div class="card-header">
       Graph Answer
    </div>
    <div class="card-body">
       <p>{{ resposta_rag }}</p>
    </div>
</div>
{% endif %}

<!-- =============================
    JS for loading states
============================= -->
<script>
function showLoadButton() {
    const fileInput = document.getElementById('file');
    const loadButtonContainer = document.getElementById('loadButtonContainer');
    loadButtonContainer.style.display = fileInput.files.length > 0 ? 'block' : 'none';
}

function showUploadSpinner() {
    document.getElementById("uploadButton").disabled = true;
    document.getElementById("uploadSpinner").style.display = "inline-block";
    document.getElementById("uploadMsg").style.display = "block";
}

function showQuestionSpinner() {
    document.getElementById("questionButton").disabled = true;
    document.getElementById("questionSpinner").style.display = "inline-block";
    document.getElementById("questionMsg").style.display = "block";
}
</script>

{% endblock %}
